<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="3"
      main_tree_to_execute="PatrolRescueMission">
  <BehaviorTree ID="PatrolRescueMission">
    <Fallback>
      <ReactiveSequence name="PatrolMode">
        <Inverter>
          <checkVictimReport victim_report=""/>
        </Inverter>
        <Fallback>
          <Sequence name="checkSection">
            <Inverter>
              <checkCurrentSection current_section="{current_section}"
                                   assigned_section="{assigned_section}"/>
            </Inverter>
            <NavigateToAssignedSection section="{assigned_section}"
                                       success=""/>
          </Sequence>
          <scan4Report victim_report=""
                       success=""/>
          <MoveInSection section="{assigned_section}"
                         success=""/>
        </Fallback>
      </ReactiveSequence>
      <Sequence name="RescueMode">
        <NavigateToVictim rescue_location="{rescue_location}"
                          success=""/>
        <ReactiveSequence>
          <Inverter>
            <isEveryoneHere/>
          </Inverter>
          <checkPositions all_robots_here="{all_robots_here}"
                          here=""/>
        </ReactiveSequence>
        <PerformSynchronization success=""/>
        <ResetVictimReport victim_report=""
                           success=""/>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="MoveInSection">
      <input_port name="section"
                  type="int"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="NavigateToAssignedSection">
      <input_port name="section"
                  type="int"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="NavigateToVictim">
      <input_port name="rescue_location"
                  type="Point3D"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="PerformSynchronization">
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="ResetVictimReport"
            editable="true">
      <output_port name="victim_report"/>
      <output_port name="success"/>
    </Action>
    <Condition ID="checkCurrentSection"
               editable="true">
      <input_port name="current_section"/>
      <input_port name="assigned_section"/>
    </Condition>
    <Action ID="checkPositions"
            editable="true">
      <input_port name="all_robots_here"/>
      <output_port name="here"/>
    </Action>
    <Condition ID="checkVictimReport"
               editable="true">
      <input_port name="victim_report"/>
    </Condition>
    <Condition ID="isEveryoneHere"
               editable="true"/>
    <Action ID="scan4Report"
            editable="true">
      <output_port name="victim_report"/>
      <output_port name="success"/>
    </Action>
  </TreeNodesModel>

</root>
