<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="3"
      main_tree_to_execute="PatrolRescueMission">
  <BehaviorTree ID="PatrolRescueMission">
    <Fallback>
      <ReactiveSequence name="PatrolMode">
        <Inverter>
          <checkVictimReport/>
        </Inverter>
        <Fallback>
          <Sequence name="checkSection">
            <Inverter>
              <checkCurrentSection current_section=""
                                   assigned_section=""/>
            </Inverter>
            <NavigateToAssignedSection section="{assigned_section}"
                                       success=""/>
          </Sequence>
          <Sequence name="VictimDetection">
            <ScanForVictim victim_found="{victim_found}"
                           victim_location="{victim_location}"/>
            <reportVictim victim_location="{victim_location}"
                          victim_found="{victim_found}"
                          success=""/>
          </Sequence>
          <Sequence name="moveInSection">
            <MoveInSection section="{assigned_section}"
                           success=""/>
          </Sequence>
        </Fallback>
      </ReactiveSequence>
      <Sequence name="RescueMode">
        <GetVictimLocation rescue_location="{rescue_location}"/>
        <NavigateToVictim rescue_location="{rescue_location}"
                          success=""/>
        <ReactiveSequence>
          <Inverter>
            <isEveryoneHere/>
          </Inverter>
          <checkPositions all_robots_here="{all_robots_here}"
                          here=""/>
        </ReactiveSequence>
        <ResetVictimReport success=""/>
        <PerformSynchronization success=""/>
        <ReturnToAssignedSection section="{assigned_section}"
                                 success=""/>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="GetVictimLocation">
      <output_port name="rescue_location"
                   type="Point3D"/>
    </Action>
    <Action ID="MoveInSection">
      <input_port name="section"
                  type="int"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="NavigateToAssignedSection">
      <input_port name="section"
                  type="int"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="NavigateToVictim">
      <input_port name="rescue_location"
                  type="Point3D"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="PerformSynchronization">
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="ResetVictimReport">
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="ReturnToAssignedSection">
      <input_port name="section"
                  type="int"/>
      <output_port name="success"
                   type="bool"/>
    </Action>
    <Action ID="ScanForVictim">
      <output_port name="victim_found"
                   type="bool"/>
      <output_port name="victim_location"
                   type="Point3D"/>
    </Action>
    <Condition ID="checkCurrentSection"
               editable="true">
      <input_port name="current_section"/>
      <input_port name="assigned_section"/>
    </Condition>
    <Action ID="checkPositions"
            editable="true">
      <input_port name="all_robots_here"/>
      <output_port name="here"/>
    </Action>
    <Condition ID="checkVictimReport"
               editable="true"/>
    <Condition ID="isEveryoneHere"
               editable="true"/>
    <Action ID="reportVictim"
            editable="true">
      <input_port name="victim_location"/>
      <input_port name="victim_found"/>
      <output_port name="success"/>
    </Action>
  </TreeNodesModel>

</root>
